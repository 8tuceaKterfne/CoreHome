@model CoreHome.Data.Model.Article

@{
    ViewData["Title"] = "Detail";
}

<link rel="stylesheet" href="~/css/blog/detail.min.css" />
<script src="~/lib/marked/marked.min.js"></script>

<div class="container mt-4 mb-5">
    <div class="row post">

        <aside class="col-lg-3 d-none d-lg-block">

            @await Component.InvokeAsync("TopTags")
            <br />
            @await Component.InvokeAsync("Categories")

        </aside>

        <selection class="col-lg-9 col-md-12">
            <article>
                <header class="post-header">
                    <h4 class="post-title">@Model.Title</h4>
                    <hr class="d-none d-md-block post-header-hr">

                    <div class="d-none d-md-block post-publish-info mb-2">
                        <strong class="text-muted">
                            <span>@Model.Time.ToString()</span>
                            | China Standard Time
                        </strong>
                    </div>

                    <p>
                        @Model.Overview
                    </p>

                    <div class="hidden-print">
                        <section class="post-cat-tag-info">
                            <div class="float-right d-none d-md-block">
                                <span class="toptags-list toptags-list-sm">
                                    @for (var i = 0; i < Model.ArticleTags.Count; i++)
                                    {
                                        <a class="btn btn-primary" asp-controller="Blog" asp-action="Tags" asp-route-id="@Model.ArticleTags[i].Tag.TagName">
                                            @Model.ArticleTags[i].Tag.TagName
                                        </a>
                                    }
                                </span>
                            </div>
                            <ul class="d-flex flex-row list-unstyled ul-cat-list-desktop mb-0">
                                <li>
                                    <a class="btn btn-sm btn-outline-success" asp-controller="Blog" asp-action="Categories" asp-route-id="@Model.Category.CategoriesName">
                                        @Model.Category.CategoriesName
                                    </a>
                                </li>
                            </ul>
                        </section>
                    </div>

                    <hr class="post-header-hr">
                </header>

                <section class="post-content clearfix markdown">
                    <input value="@Model.Content" type="hidden" />
                </section>

                <hr class="post-header-hr">
            </article>

            <form asp-controller="Blog" asp-action="Comment" method="post">
                <textarea class="form-control" rows="4" placeholder="评论（支持MarkDown）" maxlength="1024"></textarea>
                <div class="row">
                    <div class="col">
                        <div class="input-group">
                            <img id="verfyImg" onclick="getVerfyCode(this)" src="/Service/VerificationCode" />
                            <input id="verificationCode" type="text" class="form-control" placeholder="验证码" />
                        </div>
                    </div>
                    <div class="col">
                        <input id="btn_submit" type="submit" class="btn btn-success float-right" value="提交" />
                    </div>
                </div>
            </form>

            <div id="comments">

                <div class="card comment-item">
                    <div class="card-header">
                        <strong>Comments</strong>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">

                            @if (Model.Comments.Count == 0)
                            {
                                <li class="list-group-item">
                                    <div>这里什么也没有</div>
                                </li>
                            }
                            else
                            {
                                for (var i = 0; i < Model.Comments.Count; i++)
                                {
                                    <li class="list-group-item">
                                        <p class="text-muted">@Model.Comments[i].Time</p>
                                        <p class="markdown">
                                            <input value="@Model.Comments[i].Detail" type="hidden" />
                                        </p>
                                    </li>
                                }
                            }

                        </ul>
                    </div>
                </div>

            </div>
        </selection>

        <script>
            document.querySelectorAll(".markdown").forEach(element => {
                element.innerHTML = marked(element.children[0].value);
            });
        </script>
    </div>
</div>